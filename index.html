<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Home</title>
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"> -->
    <!-- Bootstrap CSS -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url('img.jpeg');
            margin: 0;
            padding: 0;
        }
        .container {
            overflow: hidden;
        }
        .container h1 {
            margin-bottom: 20px;
            text-align: center;
            font-family: 'Times New Roman', Times, serif;
            text-shadow: 4px 4px gold;
        }

        ul {
            list-style-type: none;
            padding: 20px;
            overflow: hidden;
            background-color: black;
        }

        li {
            display: inline;
        }

        li a {
            color: #ffffff;
            padding: 14px 16px;
            text-decoration: none;
        }

        

        .active {
            background-color: lightgoldenrodyellow;
            color: black;
        }
        .motor {
            padding: 2px;
            background-color: black;
            border-radius: 35px;
            color: #f8f9fa;
            font-weight: 5px;
            text-align: center;
            width: 350px;
            
        }

        .chat-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #007bff;
            color: #ffffff;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }

        .chat-icon img {
            width: 40px;
            height: 40px;
        }

        .chat-box {
            position: fixed;
            top: 120px;
            left: 35%;
            width: 400px;
            height: 550px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none; /* Initially hidden */
            z-index: 998;
        }

        /* Additional styles for chat messages and input can be added here */
        .modal-header {
            background-color: #007bff;
            color: #ffffff;
            padding: 10px;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            font-size: 16px;
        }

        .close-chat {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 20px;
            cursor: pointer;
        }

        .chat-container {
            background-color: #f8f9fa;
            /* border-radius: 15px; */
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .chat-messages {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            border-bottom: 1px solid #ddd;
        }

        .chat-input {
            display: flex;
            padding: 10px;
        }

        .chat-input input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-right: 10px;
        }

        .send-button {
            padding: 10px 20px;
            background-color: #007bff;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .send-button:hover {
            background-color: #0056b3;
        }

        .suggestions {
            margin-top: 10px;
        }
        .suggestion-btn,
        .btn-primary,
        .btn-secondary {
            border-radius: 20px;
        }
        .heading {
            color: #007bff;
        }

        .message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }
        .message strong {
            color: #007bff;
        }
        .message.user {
            background-color: #e9ecef;
            text-align: right;
        }
        .message.bot {
            background-color: #f1f1f1;
            text-align: left;
        }

    </style>
</head>
<body>

    <header>
        <nav>
            <div class="container">
                <h1>Customer Support Assistant</h1>
                <ul>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Support</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Pricing</a>
                    </li>
                    <li style="float:right">
                        <a class="active" href="#">Log Out</a>
                    </li> 
                </ul>
            </div>
        </nav>
    </header>

    <!-- <button id="toggleChat" class="chat-icon" data-toggle="modal" data-target="#chatModal"><img src="{{ url_for('static', filename='chat-icon.svg') }}" alt="Chat Icon"></button> -->

     <!-- Chat Icon -->
     <div id="toggleChat" class="chat-icon" data-toggle="modal" data-target="#chatModal">
        <i class="fas fa-comments"></i>
    </div>

        <!-- Chat Modal -->
    <div class="modal fade" id="chatModal" tabindex="-1" role="dialog" aria-labelledby="chatModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <!-- <div id="chatBox" class="chat-box"> -->
                    <!-- Chat interface content will be displayed here -->
                <div class="modal-header">
                    <h3 class="modal-title" id="chatModalLabel">Chat2</h3>
                    <button id="closeChat" class="close"  data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                    <div class="modal-body">
                        <div class="chat-container">
                            <div id="chat-box" class="chat-messages">
                                <!-- Chat messages will be appended here -->
                                <div class="message bot">
                                    <strong>Chat2Bot:</strong> Welcome to the Audit Intelligent Chatbot! The Audit Intelligent Chatbot chatbot is specifically designed to assist with financial and compliance audit manual methodologies and standards. Using advanced natural language processing (NLP), it provides accurate, contextual responses to your audit-related queries. Enjoy seamless access to vital information and enhance your auditing efficiency.
                                </div>
                            </div>
                            <div class="chat-input">
                                <input type="text" id="user-input" class="form-control" placeholder="Type a message...">
                                <button id="sendMessage" class="btn btn-primary" onclick="sendMessage()">Send</button>
                                <button class="btn btn-secondary" onclick="startRecognition()"><i class="fas fa-microphone"></i></button>
                            </div>
                            <div class="suggestions" id="suggestions">
                                <!-- Suggestions will appear here -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>



    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Speech recognition setup
        var recognition;
        if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = function() {
                console.log('Speech recognition started');
            };

            recognition.onresult = function(event) {
                var transcript = event.results[0][0].transcript;
                document.getElementById('user-input').value = transcript;
                sendMessage();  // Automatically send the message after recognition
            };

            recognition.onerror = function(event) {
                console.error('Speech recognition error', event);
            };

            recognition.onend = function() {
                console.log('Speech recognition ended');
            };
        } else {
            console.log('Speech recognition not supported');
        }

        function startRecognition() {
            if (recognition) {
                recognition.start();
            }
        }

        // Message sending functionality
        function sendMessage() {
                var userInput = document.getElementById("user-input");
                var userMessage = userInput.value.trim();

                if (userMessage !== "") {
                    appendMessage("You", userMessage, "user");
                    userInput.value = "";

                    // Send the message to the server and get the response
                    fetch("/chatbot", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({ message: userMessage })
                    })
                    .then(response => response.json())
                    .then(data => {
                        appendMessage("Chatbot", formatMessage(data.response), "bot");
                    })
                    .catch(error => {
                        console.error("Error:", error);
                    });
                }
            }

        function appendMessage(sender, message, senderClass) {
            var chatBox = document.getElementById("chat-box");
            var messageElement = document.createElement("div");
            messageElement.classList.add("message", senderClass);
            messageElement.innerHTML = `<strong>${sender}:</strong> ${message}`;
            chatBox.appendChild(messageElement);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function formatMessage(message) {
            return message.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>").replace(/\/n/g, "<br>");
        }

        // Question suggestions
        const suggestions = [
            "More Info",
            "What is auditing?",
            "How do I conduct a compliance audit?",
            "What is the purpose of financial audit manual?",
            "What are audit procedures?",
        ];

        function showSuggestions() {
            var suggestionsContainer = document.getElementById("suggestions");
            suggestionsContainer.innerHTML = "";

            suggestions.forEach(function(suggestion) {
                var suggestionButton = document.createElement("button");
                suggestionButton.classList.add("btn", "btn-secondary", "suggestion-btn");
                suggestionButton.textContent = suggestion;
                suggestionButton.onclick = function() {
                    document.getElementById("user-input").value = suggestion;
                    sendMessage();
                };
                suggestionsContainer.appendChild(suggestionButton);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            const cards = document.querySelectorAll('.card');

            const fadeInCards = () => {
                cards.forEach(function (card) {
                    const rect = card.getBoundingClientRect();
                    if (rect.top < window.innerHeight && rect.bottom >= 0) {
                        card.classList.add('fade-in');
                    }
                });
            };

            window.addEventListener('scroll', fadeInCards);
            fadeInCards(); // Initial check to see if cards are in view

            showSuggestions(); // Show suggestions when the modal is loaded
        });
        </script>


    <!-- Include jQuery -->

    <!-- Add this script at the end of your index.html -->
    <!-- <script>
        $(document).ready(function() {
            // Toggle chat box when chat icon is clicked
            $('#toggleChat').click(function() {
                $('#chatBox').toggle();
            });
        });
</script> -->


</body>
</html>
